WITH rnk AS (
SELECT
	id ,
	VIEWS,
	CASE
		WHEN VIEWS < 100 THEN 3
		WHEN VIEWS >= 350 THEN 1
		ELSE 2
	END AS gr
FROM
	stackoverflow.users
WHERE
	LOCATION LIKE '%United States%'
	AND VIEWS > 0)
SELECT
	id,
	VIEWS,
	gr
FROM
	(
	SELECT
		id,
		VIEWS,
		gr,
		MAX(VIEWS) OVER (PARTITION BY gr
	ORDER BY
		VIEWS ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING)
	FROM
		rnk
	ORDER BY
		VIEWS DESC) AS t
WHERE
	VIEWS = max
ORDER BY
	VIEWS DESC,
	id